<!DOCTYPE html>
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <title>JQuery TV Lib</title>
  <!-- Bootstrapping JQuery and Google TV UI Library. -->
  <link rel="stylesheet" href="static/tv-css/controls.css" type="text/css" media="screen" charset="utf-8"/>
  <script type="text/javascript" src="static/jquery-1.7.1.js"></script>
  <script type="text/javascript" src="static/underscore.js"></script>
  <script type="text/javascript" src="static/tv-js/gtvcore.js"></script>
  <script type="text/javascript" src="static/tv-js/keycontrol.js"></script>
  <link rel="stylesheet" href="style.css" type="text/css" media="screen" charset="utf-8"/>
</head>
<body>
  <div id="keypress-dialog"></div>
  <div id="keypress-content"></div>
  <div id="main">
  	<ul id="top-zone">
  	  <div class="item-row">
        <li class="item-parent"><div class="item">Dashboard</div></li>
        <li class="item-parent"><div class="item">Usage</div></li>
        <li class="item-parent"><div class="item">Account</div></li>
      </div>
    </ul>
    <ul id="middle-zone">
      <div class="item-page" id="1">
      <div class="item-row">
        <li class="item-parent"><div class="item">DCU 1</div></li>
        <li class="item-parent"><div class="item">DCU 2</div></li>
        <li class="item-parent"><div class="item">DCU 3</div></li>
        <li class="item-parent"><div class="item">DCU 4</div></li>
      </div>
      <div class="item-row">
        <li class="item-parent"><div class="item">DCU 5</div></li>
        <li class="item-parent"><div class="item">DCU 6</div></li>
        <li class="item-parent"><div class="item">DCU 7</div></li>
        <li class="item-parent"><div class="item">DCU 8</div></li>
      </div>
      <div class="item-row">
        <li class="item-parent"><div class="item">DCU 9</div></li>
        <li class="item-parent"><div class="item">DCU 10</div></li>
        <li class="item-parent"><div class="item">DCU 11</div></li>
        <li class="item-parent"><div class="item">DCU 12</div></li>
      </div>
      </div>
      <div class="item-page" id="2">
      <div class="item-row">
        <li class="item-parent"><div class="item">DCU 13</div></li>
        <li class="item-parent"><div class="item">DCU 14</div></li>
        <li class="item-parent"><div class="item">DCU 15</div></li>
        <li class="item-parent"><div class="item">DCU 16</div></li>
      </div>
      <div class="item-row">
        <li class="item-parent"><div class="item">DCU 17</div></li>
        <li class="item-parent"><div class="item">DCU 18</div></li>
        <li class="item-parent"><div class="item">DCU 19</div></li>
        <li class="item-parent"><div class="item">DCU 20</div></li>
      </div>
      </div>
    </ul>
    <ul id="bottom-zone">
    <h3>Notices</h3>
      <div class="item-row">
        <li class="item-parent"><div class="item">Error on DCU 1</div></li>
      </div>
      <div class="item-row">
        <li class="item-parent"><div class="item">Error on DCU 2</div></li>
      </div>
    </ul>
  </div>
<script type="text/javascript">

  var App = {}

  App.lastItem = null;
  App.curPage = 0;
  App.prevPage = 0;

  App.createKeypressHandler = function(keyName) {
    return function() {
      var dialog = $('#keypress-dialog');
      dialog.html(keyName);
      return new gtv.jq.Selection(keyName);
    }
  };

  App.scrollItemToItem = function(item, scrollToItem) {
    // Translate new item to the other item's position
    var itemOffsetW = item.position().left - scrollToItem.position().left;
    item.parent().parent().css('-webkit-transform','translate(-' + itemOffsetW + 'px, 0)');
  };

  App.scrollLeftRight = function(oldItem, newItem) {
    /*--Executed when the left/right key is pressed while last item from right or left are selected--*/
    if (!newItem.length) {
      return new gtv.jq.Selection('none');
    }
    // Check if new item fits into parent elements viewport
    var rowEl = newItem.parent().parent().parent();
    var rowLeft = rowEl.position().left;
    var rowRight = rowLeft + rowEl.width();
    var newItemLeft = newItem.position().left;
    var newItemRight = newItemLeft + newItem.width();
    if (newItemRight > rowRight) {
      // Scrolling right. Match item to first item's position.
      App.scrollItemToItem(newItem, newItem.parent().parent().children().first());
      App.lastItem = App.lastItem || oldItem;
    }
    else if (newItemLeft < rowLeft) {
      // Scrolling left. Match item to last item's position.
      App.scrollItemToItem(newItem, App.lastItem);
    }
    return new gtv.jq.Selection('none');
  };

  App.scrollUpDown = function(oldItem, newItem) {
    if (!newItem) {
      return new gtv.jq.Selection('none');
    }
    var pageEl = newItem.parent().parent().parent();
    var pageNo = pageEl.attr('id').match(/\d+/)[0];
    //Change page number
    App.curPage = pageNo;
    App.prevPage = pageNo - 1;

    if(App.curPage == App.prevPage + 1) {
      $('div').filter('#'+ App.prevPage).hide();
      $('div').filter('#'+ App.curPage).show();
    }
    else if(App.curPage == App.prevPage - 1) {
      $('div').filter('#'+ App.curPage).hide();
      $('div').filter('#'+ App.prevPage).show();
    }
    else {
      //Do nothing
    }
    return new gtv.jq.Selection('none');
  };

  App.enterKeyFunction = function(item) {
    var selected = item.html();
    var dialog = $('#keypress-content');
    dialog.html(selected);
    return new gtv.jq.Selection('none');
  };

  var keyController = new gtv.jq.KeyController();
  /* Add callback functions to keymap */
  keyController.setGlobalKeyMapping({
      8: App.createKeypressHandler('BACKSPACE'),
      9: App.createKeypressHandler('TAB'),
      13: App.createKeypressHandler('ENTER'),
      37: App.createKeypressHandler('LEFT'),
      38: App.createKeypressHandler('UP'),
      39: App.createKeypressHandler('RIGHT'),
      40: App.createKeypressHandler('DOWN')
    });
    keyController.start();

    /* Define the behavior zones of the page */
    var topZone = new gtv.jq.KeyBehaviorZone({
      containerSelector: '#top-zone',
      navSelectors: {
        item: '.item',
        itemParent: '.item-parent',
        itemRow: '.item-row',
        itemPage: null
      },
      selectionClasses: {
        basic: 'item-selected'
      },
      keyMapping: {
        13: App.enterKeyFunction,
        37: App.scrollLeftRight,
        39: App.scrollLeftRight
      },
      actions: {
      },
      useGeometry: false
    });

    var middleZone = new gtv.jq.KeyBehaviorZone({
      containerSelector: '#middle-zone',
      navSelectors: {
        item: '.item',
        itemParent: '.item-parent',
        itemRow: '.item-row',
        itemPage: '.item-page'
      },
      selectionClasses: {
        basic: 'item-selected'
      },
      keyMapping: {
        13: App.enterKeyFunction,
        38: App.scrollUpDown,
        40: App.scrollUpDown
      },
      actions: {
      },
      useGeometry: true,
      selectHidden: true
    });

    var bottomZone = new gtv.jq.KeyBehaviorZone({
      containerSelector: '#bottom-zone',
      navSelectors: {
        item: '.item',
        itemParent: '.item-parent',
        itemRow: '.item-row',
        itemPage: null
      },
      selectionClasses: {
        basic: 'item-selected'
      },
      keyMapping: {
        13: App.enterKeyFunction,
      },
      actions: {
      },
      useGeometry: false
    });

    keyController.addBehaviorZone(topZone, true);
    keyController.addBehaviorZone(middleZone);
    keyController.addBehaviorZone(bottomZone);
  </script>
</body>